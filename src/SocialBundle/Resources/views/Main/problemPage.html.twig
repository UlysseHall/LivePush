{% extends "SocialBundle::layout.html.twig" %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('ressources/css/social/problemPage.css') }}">
	<link rel="stylesheet" href="{{ asset('bundles/code-prettify/skins/desert.css') }}">
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('bundles/code-prettify/prettify.js') }}"></script>
	<script src="{{ asset('ressources/js/social/displayFileCode.js') }}"></script>
	<script>
		$(function () {
  			$('[data-toggle="popover"]').popover({html: true});
		})</script>
{% endblock %}

{% block social_right_pan %}

    <div class="row pb-page-header">
        <h1>
            {{ problem.titre|raw }}
            
            <img src="{{ asset('ressources/img/langage-logo/'~problem.langage|lower~'.png') }}" alt="langage-logo">
            
            <span class="pb-page-date">
                {{ problem.auteur }} - 
                Il y a {{ problem.date|date('Y-m-d H:i:s')|prettydate }}
            </span>
        </h1>
    </div>
    
    <div class="row pb-page-content">
        {{ problem.contenu|raw }}
    </div>
    
    {% if problem.nbFiles > 0 %}
        <div class="row pb-page-files">
            
			{% for fichier in fichiersContent %}
				<div class="col-lg-3 col-md-4 col-sm-6 col-xs-6 file-container" data-file-code="{{ fichier.content }}" data-file-name="{{ fichier.name }}">
					<center>
						<img class="page-file-icon" src="{{ asset('ressources/img/icons/file.png') }}" alt="file-icon">
					</center>
					
					<p class="page-file-name">{{ fichier.name }}</p>
				</div>
			{% endfor %}
       
        </div>
    {% endif %}
    
    <section class="pb-comments row col-xs-10 col-xs-offset-1">
       	
       	{% if connected == true %}
			<form class="comment-form row" method="POST" action="{{ path('social_problem_comment_add', {'problem_id': problem.id}) }}">
			   <div class="form-group row col-xs-10 col-xs-offset-1">
					<textarea class="form-control comment-input" minlength="2" rows="4" id="comment" name="comment" placeholder="Publiez une solution" required></textarea>
			   </div>

			   <div class="form-confirmation form-group row col-xs-10 col-xs-offset-1">
					<button type="submit" class="btn btn-success pull-right">Publier</button>
			   </div>
			</form>
      	{% endif %}
        
        <div class="row pb-comments-list">
			{% for com in comsContent %}
				<div class="col-xs-12 pb-comments-comment">
					<div class="col-xs-8">
						<p class="com-author">{{ com.author.username }}</p>
					</div>
					
					<div class="col-xs-4 com-date-container">
						{% if com.author == app.user %}
							<p class="com-date">
								<button type="button" class="btn btn-danger btn-xs comment-delete" data-toggle="popover" data-content="<a class='btn btn-danger' href=&#34;{{ path('social_problem_comment_remove', {'comment_id': com.id}) }}&#34;>Supprimer</a>" data-placement="top" data-trigger="focus">
									<span class="glyphicon glyphicon-trash">
									</span>
								</button>
								{{ com.date|date('Y-m-d H:i:s')|prettydate }}
							</p>
						{% endif %}
						
					</div>
					
					<div class="col-xs-12">
						<p class="com-content">{{ com.content }}</p>
					</div>
					
					{% if not com.editedName is null and not com.editedContent is null %}
						<div class="col-xs-12 label-has-correction-container">
							<div data-edited-code-name="{{ com.editedName }}" data-edited-code="{{ com.editedContent }}" class="label label-success label-has-correction">Correction de {{ com.editedName }}</div>
						</div>
					{% endif %}
				</div>
			{% endfor %}
        </div>
        
    </section>

{% endblock %}